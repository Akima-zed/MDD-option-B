<app-header></app-header>

<div class="article-container">
  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner></mat-spinner>
  </div>

  <div *ngIf="errorMessage" class="error-message">
    {{ errorMessage }}
    <button mat-raised-button color="primary" (click)="goBack()">Back to feed</button>
  </div>

  <div *ngIf="!isLoading && article" class="article-content">
    <button mat-icon-button (click)="goBack()" class="back-button" aria-label="Back">
      <mat-icon>arrow_back</mat-icon>
    </button>

    <article class="article-main">
      <header class="article-header">
        <h1 class="article-title">{{ article.title }}</h1>

        <div class="article-meta">
          <div class="article-theme">
            <mat-icon>label</mat-icon>
            <span>{{ article.theme.name }}</span>
          </div>

          <div class="article-info">
            <span class="author">By {{ article.author.username }}</span>
            <span class="separator"> â€¢ </span>
            <span class="date">{{ article.dateCreation | date: 'dd MMMM yyyy' }}</span>
          </div>
        </div>
      </header>

      <div class="article-body">
        <p>{{ article.content }}</p>
      </div>
    </article>

    <section class="comments-section">
      <h2 class="comments-title">Comments</h2>

      <mat-card class="comment-form-card">
        <form [formGroup]="commentForm" (ngSubmit)="onSubmitComment()">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Write your comment</mat-label>
            <textarea matInput formControlName="content" rows="4" required></textarea>

            <mat-error *ngIf="commentForm.get('content')?.hasError('required')">
              Comment is required
            </mat-error>
            <mat-error *ngIf="commentForm.get('content')?.hasError('minlength')">
              Minimum 3 characters
            </mat-error>
          </mat-form-field>

          <div class="form-actions">
            <button mat-raised-button color="primary" type="submit"
                    [disabled]="commentForm.invalid || isSubmitting">
              {{ isSubmitting ? 'Sending...' : 'Send' }}
            </button>
          </div>
        </form>
      </mat-card>

      <div class="comments-list">
        <mat-card *ngFor="let comment of comments" class="comment-card">
          <div class="comment-header">
            <span class="comment-author">{{ comment.author.username }}</span>
            <span class="comment-date">{{ comment.dateCreation | date: 'dd/MM/yyyy' }}</span>
          </div>

          <p class="comment-content">{{ comment.content }}</p>
        </mat-card>

        <div *ngIf="comments.length === 0" class="no-comments">
          <mat-icon>chat_bubble_outline</mat-icon>
          <p>No comments yet.</p>
        </div>
      </div>
    </section>
  </div>
</div>